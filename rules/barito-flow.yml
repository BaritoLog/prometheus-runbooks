groups:
  - name: barito-flow
    rules:
      - alert: BaritoFlowMessageLoss
        expr: |
          ((increase(kafka_topic_partition_current_offset:per_app_group_topic[1h]) - increase(elasticsearch_indices_docs_primary:per_topic[1h])) * 100 / increase(kafka_topic_partition_current_offset:per_app_group_topic[1h])) > 10
        for: 5m
        labels:
          severity: warning
          tag: barito-flow-message-loss
        annotations:
          summary: "Barito flow message loss in last hour for `{{ $labels.app_group}}.{{ $labels.topic }}`, current value: {{ $value | humanize }}%"

      - alert: BaritoFlowTPSExceededSpike
        expr: |
          increase(barito_producer_tps_exceeded_total[2m])/2 > (increase(barito_producer_tps_exceeded_total[2m] offset 1m)/2 * 1.5)
        for: 5m
        labels:
          severity: warning
          tag: barito-flow-tps-exceeded-spike
        annotations:
          summary: "Barito flow message(s) are discarded because of TPS exceeded for `{{ $labels.app_group }}.{{ $labels.topic }}`, current value: {{ $value | humanize }}"
