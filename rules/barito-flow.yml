groups:
  - name: Barito Flow
    rules:
      - alert: Barito Flow Message Loss
        expr: |
          ((increase(kafka_topic_partition_current_offset:per_app_group_topic[1h]) - increase(elasticsearch_indices_docs_primary:per_topic[1h])) * 100 / increase(kafka_topic_partition_current_offset:per_app_group_topic[1h])) > 10
        for: 5m
        labels:
          severity: warning
        annotations:
          summary: "Message loss at `{{ $value | humanize }}%` in last hour for `{{ $labels.app_group}}.{{ $labels.topic }}`"

      - alert: Barito Flow TPS Excedeed
        expr: |
          increase(barito_producer_tps_exceeded_total[1m]) > 0
        for: 5m
        labels:
          severity: warning
        annotations:
          summary: "`{{ $value | humanize }}` message(s) are discarded because of TPS exceeded for `{{ $labels.app_group }}.{{ $labels.topic }}`"
