groups:
  - name: component-redis
    rules:
      - alert: RedisDown
        expr: redis_up == 0
        for: 5m
        labels:
          severity: critical
        annotations:
          summary: "Redis is down {{ $labels.instance }} {{ $labels.name }}"

      - alert: RedisReplicationBroken
        expr: delta(redis_connected_slaves[1d]) < 0
        for: 5m
        labels:
          severity: critical
        annotations:
          summary: "Redis replication broken {{ $labels.instance }} {{ $labels.name }}"

      - alert: RedisTooManyConnections
        expr: redis_connected_clients > 200
        for: 5m
        labels:
          severity: critical
        annotations:
          summary: "Redis too many connections {{ $labels.instance }} {{ $labels.name }}, current value: {{ $value | humanize }}"

      - alert: RedisRejectedConnections
        expr: increase(redis_rejected_connections_total[1m]) > 0
        for: 5m
        labels:
          severity: critical
        annotations:
          summary: "Redis have rejected connections {{ $labels.instance }} {{ $labels.name }}, current value: {{ $value | humanize }}"

      - alert: RedisMissingBackup
        expr: time() - redis_rdb_last_save_timestamp_seconds > 60 * 60 * 24
        for: 5m
        labels:
          severity: warning
        annotations:
          summary: "Redis missing backup for 24 hours {{ $labels.instance }} {{ $labels.name }}, current value: {{ $value | humanize }}"
