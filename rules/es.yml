groups:
  - name: ElasticSearch
    rules:
      - alert: ElasticSearch Unassigned Shards
        expr: elasticsearch_cluster_health_unassigned_shards{} > 0
        for: 10m
        labels:
          severity: warning
        annotations:
          summary: "Unassigned shards, {{ $labels.instance }}, current: {{ $value }}"
      - alert: ElasticSearch Cluster Yellow
        expr: elasticsearch_cluster_health_status{color="yellow"} == 1
        for: 10m
        labels:
          severity: warning
        annotations:
          summary: "Elastic Cluster Yellow, {{ $labels.instance }}"
      - alert: ElasticSearch Cluster Red
        expr: elasticsearch_cluster_health_status{color="red"} == 1
        for: 5m
        labels:
          severity: critical
        annotations:
          summary: "Elastic Cluster Red, {{ $labels.instance }}"
      - alert: ElasticSearch Exporter Error
        expr: count({__name__=~"elasticsearch_clusterinfo_version_info|elasticsearch_jvm_buffer_pool_used_bytes"}) by (app_group) < 2
        for: 10m
        labels:
          severity: warning
        annotations:
          summary: "Exporter experienced timeout when fetch elasticsearch data, {{ $labels.instance }}"
      - alert: ElasticsearchNodesNotMatch
        expr: count by (app_group) (elasticsearch_cluster_health_number_of_nodes{app_group!="hino", app_group!="hitzu"}) != avg by (app_group) (elasticsearch_cluster_health_number_of_nodes{app_group!="hino", app_group!="hitzu"})
        for: 5m
        labels:
          severity: critical
        annotations:
          summary: "Number of container not match with total registered nodes in the cluster"
