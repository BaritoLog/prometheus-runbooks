groups:
  - name: component-elasticsearch
    rules:
      - alert: ESClusterRed
        expr: elasticsearch_cluster_health_status{color="red"} == 1
        for: 5m
        labels:
          severity: critical
        annotations:
          summary: "Elastic cluster status is red {{ $labels.instance }} {{ $labels.name }}"

      - alert: ESReadOnlyIndex
        expr: sum by (app_group) (elasticsearch_indices_settings_stats_read_only_indices) > 0
        for: 30s
        labels:
          severity: critical
        annotations:
          summary: "Elastic have {{ $value | humanize }} read-only indices on {{ $labels.app_group }}"

      - alert: ESHighHeapMemoryUsage
        expr: (elasticsearch_jvm_memory_used_bytes / elasticsearch_jvm_memory_max_bytes) * 100 > 90
        for: 10m
        labels:
          severity: critical
        annotations:
          summary: "Elastic heap memory usage high {{ $labels.instance }} {{ $labels.name }}, current value: {{ $value | humanize }}%"
