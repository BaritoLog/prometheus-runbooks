groups:
  - name: Consul
    rules:
    - alert: ContainerCritical
      expr: consul_health_node_status{check="serfHealth", status="critical"} == 1
      for: 2m
      labels:
        severity: critical
      annotations:
        summary: "Component *{{ $labels.node }}* in `critical` state, instance *{{ $labels.instance }}*"
    - alert: ConsulDown
      expr: (consul_up == 0) OR (count(consul_up offset 1d) by (app_group, instance) - count(consul_up) by (app_group, instance) > 0)
      for: 10m
      labels:
        severity: critical
      annotations:
        summary: "Consul is down for *{{ $labels.app_group}}*, instance *{{ $labels.instance }}*"
