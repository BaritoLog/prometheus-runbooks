groups:
  - name: component-consul
    rules:
      - alert: ConsulAgentUnhealthy
        expr: consul_health_node_status{status="critical"} == 1
        for: 5m
        labels:
          severity: critical
        annotations:
          summary: "Consul agent unhealthy {{ $labels.instance }} {{ $labels.name }}"

      - alert: ConsulServiceHealthcheckFailed
        expr: max(consul_health_node_status{status="critical", node!~".*(consumer|producer).*"}) by (app_group, node, check) == 1
        for: 10m
        labels:
          severity: critical
        annotations:
          summary: "Consul service healtcheck failed for {{ $labels.node }} {{ $labels.check }}"
