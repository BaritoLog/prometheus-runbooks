groups:
  - name: Global
    rules:
    - alert: MessageLoss
      expr: ((increase(kafka_topic_partition_current_offset:per_app_group_topic[1h]) - increase(elasticsearch_indices_docs_primary:per_topic[1h]) ) * 100 / increase(kafka_topic_partition_current_offset:per_app_group_topic[1h])) > 10
      for: 30s
      labels:
        severity: warning
      annotations:
        summary: "Message loss at `{{ $value | humanize }}%` in last hour for `{{ $labels.app_group}}.{{ $labels.topic }}`"
